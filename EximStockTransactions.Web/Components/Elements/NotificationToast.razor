@using EximStockTransactions.Web.Services
@implements IDisposable
@inject NotificationService NotificationService

<div class="notification-container">
  @foreach (var notification in notifications)
  {
    <div class="alert alert-@notification.Type.ToString().ToLower() alert-dismissible fade show" role="alert">
      <strong>@notification.Title</strong> @notification.Message
      <button type="button" class="btn-close" @onclick="() => Dismiss(notification.Id)"></button>
    </div>
  }
</div>

@code {
  private List<Notification> notifications = new();
  private int nextId = 1;

  protected override void OnInitialized()
  {
    NotificationService.OnShow += ShowNotification;
  }

  private async Task ShowNotification(string message, string title)
  {
    var notification = new Notification
    {
      Id = nextId++,
      Message = message,
      Title = title,
      Type = title == "Error" ? NotificationType.Error :
               title == "Warning" ? NotificationType.Warning : NotificationType.Success
    };

    notifications.Add(notification);
    StateHasChanged();

    await Task.Delay(5000);
    Dismiss(notification.Id);
  }

  private void Dismiss(int id)
  {
    var notification = notifications.FirstOrDefault(n => n.Id == id);
    if (notification != null)
    {
      notifications.Remove(notification);
      StateHasChanged();
    }
  }

  public void Dispose()
  {
    NotificationService.OnShow -= ShowNotification;
  }

  private class Notification
  {
    public int Id { get; set; }
    public string Message { get; set; } = string.Empty;
    public string Title { get; set; } = string.Empty;
    public NotificationType Type { get; set; }
  }

  private enum NotificationType { Success, Error, Warning }
}